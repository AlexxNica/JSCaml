49,52c49
< #include <wtf/ASCIICType.h>
< #include <wtf/FastMalloc.h>
< 
< using namespace WTF;
---
> #include "ASCIICType.h"
190c187
<     
---
> 
192c189
<     
---
> 
196c193
<     
---
> 
207c204
<     
---
> 
223c220
<                 
---
> 
235c232
<                 
---
> 
238c235
<                 
---
> 
302c299
<                 
---
> 
309c306
<     
---
> 
338c335
<     
---
> 
343c340
<     
---
> 
349c346
<     
---
> 
376c373
<     
---
> 
379c376
<     
---
> 
386c383
<     
---
> 
389c386
<     
---
> 
407c404
<     
---
> 
410c407
<     
---
> 
478c475
<     
---
> 
483c480
<     
---
> 
486c483
<     
---
> 
489c486
<     
---
> 
495c492
<     
---
> 
498c495
<     
---
> 
508c505
<  
---
> 
512c509
<  
---
> 
570d566
<     const UChar* tempptr;
573c569
<     
---
> 
577c573
<     
---
> 
582c578
<      
---
> 
587c583
<     
---
> 
592c588
<     
---
> 
597c593
<     
---
> 
599c595
<     
---
> 
601c597
<     
---
> 
612c608
<         
---
> 
614c610
<         
---
> 
616c612
<         
---
> 
619c615
<         
---
> 
621c617
<         
---
> 
624c620
<                 
---
> 
636c632
<                 
---
> 
639c635
<                 
---
> 
644c640,642
<                 }
---
>                     *code++ = OP_BOL;
>                 } else
>                     *code++ = OP_CIRC;
646d643
<                 *code++ = OP_CIRC;
648c645
<                 
---
> 
651c648,651
<                 *code++ = OP_DOLL;
---
>                 if (options & MatchAcrossMultipleLinesOption)
>                   *code++ = OP_EOL;
>                 else
>                   *code++ = OP_DOLL;
653c653
<                 
---
> 
656c656
<                 
---
> 
665c665
<                 
---
> 
671c671
<              
---
> 
677c677
<                 
---
> 
681c681
<                 
---
> 
684c684
<                 
---
> 
697c697
<                 
---
> 
701c701
<                 
---
> 
704c704
<                 
---
> 
707c707
<                 
---
> 
712c712
<                 
---
> 
714c714
<                 
---
> 
728c728
<                     
---
> 
738c738
<                                     
---
> 
744c744
<                                     
---
> 
749c749
<                                     
---
> 
755c755
<                                     
---
> 
760c760
<                                     
---
> 
766c766
<                                     
---
> 
770c770
<                                     
---
> 
776c776
<                         
---
> 
779c779
<                         
---
> 
781c781
<                     
---
> 
785c785
<                     
---
> 
788c788
<                         
---
> 
790c790
<                         
---
> 
794c794
<                         
---
> 
798c798
<                             
---
> 
805c805
<                         
---
> 
808c808
<                         
---
> 
811c811
<                         
---
> 
816c816
<                         
---
> 
819c819
<                             
---
> 
823c823
<                             
---
> 
831c831
<                                     
---
> 
842c842
<                                     
---
> 
852c852
<                             
---
> 
855c855
<                             
---
> 
859c859
<                             
---
> 
863c863
<                             
---
> 
866c866
<                         
---
> 
870c870
<                         
---
> 
880c880
<                         
---
> 
883c883
<                     
---
> 
887c887
<                     
---
> 
889c889
<                     
---
> 
891c891
<                     
---
> 
896c896
<                         
---
> 
915c915
<                 
---
> 
922c922
<                  
---
> 
929c929
<                 
---
> 
932c932
<                     
---
> 
934c934
<                     
---
> 
943c943
<                     
---
> 
946c946
<                     
---
> 
950c950
<                 
---
> 
955c955
<                 
---
> 
959c959
<                 
---
> 
963c963
<                 
---
> 
969c969
<                     
---
> 
972c972
<                     
---
> 
978c978
<                     
---
> 
980c980
<                     
---
> 
986c986
<                     
---
> 
988c988
<                     
---
> 
992c992
<                 
---
> 
997c997
<                 
---
> 
1007c1007
<                 
---
> 
1018c1018
<                 
---
> 
1023c1023
<                 
---
> 
1028c1028
<                 
---
> 
1032c1032
<                 
---
> 
1038c1038
<                 
---
> 
1043c1043
<                 
---
> 
1045c1045
<                 
---
> 
1047c1047
<                 
---
> 
1049c1049
<                 
---
> 
1053c1053
<                 
---
> 
1055c1055
<                 
---
> 
1061c1061
<                 
---
> 
1067c1067
<                 
---
> 
1073c1073
<                 
---
> 
1079c1079
<                     
---
> 
1093c1093
<                     
---
> 
1096c1096
<                 
---
> 
1103c1103
<                 
---
> 
1108c1108
<                 
---
> 
1114c1114
<                 
---
> 
1118c1118
<                 
---
> 
1122c1122
<                     
---
> 
1126c1126
<                     
---
> 
1129c1129
<                     
---
> 
1132c1132
<                     
---
> 
1135c1135
<                     
---
> 
1137c1137
<                     
---
> 
1139c1139
<                     
---
> 
1142c1142
<                     
---
> 
1153c1153
<                     
---
> 
1158c1158
<                     
---
> 
1170c1170
<                     
---
> 
1173c1173
<                     
---
> 
1177c1177
<                         
---
> 
1183c1183
<                         
---
> 
1197c1197
<                         
---
> 
1200c1200
<                         
---
> 
1216c1216
<                     
---
> 
1218c1218
<                     
---
> 
1224c1224
<                     
---
> 
1227c1227
<                     
---
> 
1233c1233
<                 
---
> 
1236c1236
<                 
---
> 
1246c1246
<                     
---
> 
1261c1261
<                 
---
> 
1264c1264
<                 
---
> 
1269c1269
<                     
---
> 
1275c1275
<                     
---
> 
1281c1281
<                     
---
> 
1288c1288
<                     
---
> 
1292c1292
<                         
---
> 
1297c1297
<                         
---
> 
1303c1303
<                         
---
> 
1310c1310
<                         
---
> 
1317c1317
<                         
---
> 
1324c1324
<                             
---
> 
1327c1327
<                             
---
> 
1332c1332
<                         
---
> 
1335c1335
<                     
---
> 
1340c1340
<                     
---
> 
1353c1353
<                     
---
> 
1359c1359
<                     
---
> 
1363c1363
<                             
---
> 
1366c1366
<                             
---
> 
1373c1373
<                             
---
> 
1377c1377
<                         
---
> 
1380c1380
<                         
---
> 
1391c1391
<                     
---
> 
1396c1396
<                     
---
> 
1400c1400
<                 
---
> 
1402c1402
<                 
---
> 
1407c1407
<                 
---
> 
1411c1411
<                 
---
> 
1416c1416
<                 
---
> 
1423c1423
<                 
---
> 
1426c1426
<                 
---
> 
1433c1433
<                             
---
> 
1438c1438
<                             
---
> 
1443c1443
<                             
---
> 
1445c1445
<                             
---
> 
1451c1451
<                 
---
> 
1455c1455
<                 
---
> 
1466c1466
<                 
---
> 
1471c1471
<                 
---
> 
1476c1476
<                 
---
> 
1489c1489
<                 
---
> 
1494c1494
<                 
---
> 
1500c1500
<                 
---
> 
1504c1504
<                 
---
> 
1511c1511
<                     
---
> 
1521c1521
<                     
---
> 
1525c1525
<                     
---
> 
1528c1528
<                     
---
> 
1531c1531
<                     
---
> 
1535c1535
<                 
---
> 
1543c1543
<                 
---
> 
1546c1546
<                 
---
> 
1548c1548
<                 
---
> 
1550c1550
<                 
---
> 
1552c1552
<                 
---
> 
1558c1558
<                 
---
> 
1562c1562
<                 
---
> 
1564d1563
<                 tempptr = ptr;
1566c1565
<                 
---
> 
1573c1572
<                 
---
> 
1577c1576
<                     
---
> 
1580c1579
<                     
---
> 
1582c1581
<                     
---
> 
1585c1584
<                     
---
> 
1587c1586
<                     
---
> 
1594c1593
<                     
---
> 
1597c1596
<                     
---
> 
1604c1603
<                 
---
> 
1606c1605
<                 
---
> 
1610c1609
<                 
---
> 
1613c1612
<                 
---
> 
1615c1614
<                 
---
> 
1619c1618
<                     
---
> 
1629c1628
<                     
---
> 
1634c1633
<                 
---
> 
1639c1638
<                 
---
> 
1643c1642
<                     
---
> 
1646c1645
<                     
---
> 
1655c1654
<                 
---
> 
1658c1657
<                 
---
> 
1665c1664
<                 
---
> 
1669c1668
<     
---
> 
1673c1672
<     
---
> 
1716c1715
<     
---
> 
1718c1717
<     
---
> 
1721c1720
<     
---
> 
1723c1722
<     
---
> 
1726c1725
<         
---
> 
1734c1733
<         
---
> 
1737c1736
<         
---
> 
1742c1741
<         
---
> 
1747c1746
<         
---
> 
1752c1751
<             
---
> 
1758c1757
<             
---
> 
1761c1760
<             
---
> 
1764c1763
<             
---
> 
1766c1765
<             
---
> 
1772c1771
<         
---
> 
1781c1780
<         
---
> 
1790c1789
<             
---
> 
1792c1791
<             
---
> 
1796c1795
<             
---
> 
1798c1797
<             
---
> 
1805c1804
<         
---
> 
1810c1809
<         
---
> 
1846c1845
<     /* Check for explicit anchoring */    
---
>     /* Check for explicit anchoring */
1886c1885
<     
---
> 
1895c1894
<     
---
> 
1899c1898
<     
---
> 
1902c1901
<     
---
> 
1907c1906
<     return op == OP_CIRC;
---
>     return op == OP_CIRC || op == OP_BOL;
1944c1943
<     
---
> 
1947c1946
<     
---
> 
1951c1950
<             
---
> 
2016,2019c2015,2018
<     
<     const UChar* ptr = (const UChar*)(pattern - 1);
<     const UChar* patternEnd = (const UChar*)(pattern + patternLength);
<     
---
> 
>     const UChar* ptr = reinterpret_cast<const UChar*>(pattern - 1);
>     const UChar* patternEnd = reinterpret_cast<const UChar*>(pattern + patternLength);
> 
2032c2031
<                 
---
> 
2034c2033
<                 
---
> 
2037c2036
<                     
---
> 
2045c2044
<                     
---
> 
2048c2047
<                 
---
> 
2050c2049
<                 
---
> 
2052c2051
<                 
---
> 
2056c2055
<                 
---
> 
2077c2076
<                 
---
> 
2084c2083
<                 
---
> 
2090c2089
<                 
---
> 
2100c2099
<                 
---
> 
2102c2101
<                 
---
> 
2106c2105
<                 
---
> 
2108c2107
<                 
---
> 
2117c2116
<                 
---
> 
2127c2126
<                 
---
> 
2132c2131
<                 
---
> 
2138c2137
<                 
---
> 
2146c2145
<                 
---
> 
2155c2154
<                 
---
> 
2157c2156
<                 
---
> 
2160c2159
<                     
---
> 
2165c2164
<                         
---
> 
2167c2166
<                         
---
> 
2170c2169
<                         
---
> 
2173c2172
<                         
---
> 
2177c2176
<                     
---
> 
2183c2182
<                     
---
> 
2186c2185
<                         
---
> 
2188c2187
<                         
---
> 
2191c2190
<                         
---
> 
2206c2205
<                         
---
> 
2209c2208
<                         
---
> 
2216c2215
<                             
---
> 
2224c2223
<                                 
---
> 
2230c2229
<                                 
---
> 
2238c2237
<                                         
---
> 
2249c2248
<                                         
---
> 
2251c2250
<                                         
---
> 
2256c2255
<                                 
---
> 
2258c2257
<                                 
---
> 
2261c2260
<                             
---
> 
2263c2262
<                         
---
> 
2268c2267
<                         
---
> 
2283c2282
<                 
---
> 
2288c2287
<                 
---
> 
2300c2299
<                     
---
> 
2303c2302
<                     
---
> 
2324c2323
<                 
---
> 
2329c2328
<                 
---
> 
2331c2330
<                 
---
> 
2338c2337
<                             
---
> 
2344c2343
<                             
---
> 
2349c2348
<                             
---
> 
2356c2355
<                 
---
> 
2360c2359
<                 
---
> 
2366c2365
<                 
---
> 
2371c2370
<                 
---
> 
2376c2375
<                 
---
> 
2379c2378
<                 
---
> 
2400c2399
<                 
---
> 
2403c2402
<                 
---
> 
2424c2423
<                 
---
> 
2429c2428
<                 
---
> 
2446c2445
<                 
---
> 
2452c2451
<                 
---
> 
2473c2472
<                 
---
> 
2475c2474
<                 
---
> 
2486c2485
<                 
---
> 
2500c2499
<                 
---
> 
2504c2503
<     
---
> 
2541c2540,2541
<                 unsigned* numSubpatterns, const char** errorptr)
---
>                 unsigned* numSubpatterns, const char** errorptr,
>                 malloc_t* allocate_function, free_t* free_function)
2548c2548
<     
---
> 
2550c2550
<     
---
> 
2558c2558
<     
---
> 
2561c2561
<     
---
> 
2563,2564c2563,2564
<     JSRegExp* re = reinterpret_cast<JSRegExp*>(new char[size]);
<     
---
>     JSRegExp* re = reinterpret_cast<JSRegExp*>((*allocate_function)(size));
> 
2567c2567
<     
---
> 
2569c2569
<     
---
> 
2572,2574c2572,2574
<     
<     const unsigned char* codeStart = (const unsigned char*)(re + 1);
<     
---
> 
>     unsigned char* codeStart = reinterpret_cast<unsigned char*>(re + 1);
> 
2578,2579c2578,2579
<     
<     const UChar* ptr = (const UChar*)pattern;
---
> 
>     const UChar* ptr = reinterpret_cast<const UChar*>(pattern);
2581c2581
<     unsigned char* code = (unsigned char*)codeStart;
---
>     unsigned char* code = reinterpret_cast<unsigned char*>(codeStart);
2592c2592
<     
---
> 
2594c2594
<     
---
> 
2597c2597
<     
---
> 
2600c2600
<     
---
> 
2606c2606
<     
---
> 
2609c2609
<     
---
> 
2612c2612
<     
---
> 
2614c2614
<     
---
> 
2616c2616
<         delete [] reinterpret_cast<char*>(re);
---
>         (*free_function)(reinterpret_cast<void*>(re));
2619c2619
<     
---
> 
2623c2623
<      
---
> 
2629c2629
<     
---
> 
2650c2650
<     
---
> 
2654c2654
<     
---
> 
2662c2662
<     
---
> 
2668c2668
< void jsRegExpFree(JSRegExp* re)
---
> void jsRegExpFree(JSRegExp* re, free_t* free_function)
2670c2670
<     delete [] reinterpret_cast<char*>(re);
---
>     (*free_function)(reinterpret_cast<void*>(re));
